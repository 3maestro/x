<!DOCTYPE html>
<!-- layout:decorate 레이아웃 활용을 위한 속성 -->
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
      
<th:block layout:fragment="customTitle">
	<title>표준정기점검표</title>
</th:block>

<th:block layout:fragment="customScript">
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script type="text/javascript">
		
		$(document).ready(function(){
			
			$('#periodBtn').click(function(){
				var check = [];
				var checkSize = $("input:checkbox[name='check']:checked").length
				console.log(checkSize)
/* 				var checkVal; 
				$('input:checkbox[name="check"]').each(function(){
					checkVal = $("input:checkbox[name='check']:checked").val()
					console.log(checkVal + '!!!!')
					
				}) */
				
 				var checkThis = $('table[name="routineList"]')
 				console.log(checkThis + '<-this')
                $('input[name="check"]:checked').each(function(i){//체크된 리스트 저장
                    var checked = check.push($(this).val());
                	console.log(checked + "<-enen")
                });
				
				if(check == "undefined" || check == null){
					alert('항목을 체크 하시오.')
				}else{
					console.log(check + '<-뭐니')
					var request = $.ajax({
						  url: "/askCheck",	//호출될 url
						  method: "POST",
						  //최근 수리 내역 중 수리항목코드와 당시 수리 날짜
						  data: {"check" : check, "car":"KHMAJOU135795"},//파라미터
						  dataType: "json"		//응답 타입
					});
						 			
					request.done(function( data ) {
						console.log(data + " <-data")
					
					for(var i=0; i<data.length; i++){
						var getRiCode = data[i];
						//console.log(getRiCode)
//						console.log(checkVal + '<-checkVal')
						if(getRiCode == check[i]){
							console.log(check[i])
  							console.log('교환필요')
  							var o =checkThis.find('#o')
  							
// // 							//console.log(check + '<-check?')
 							o.attr('style', 'display: block')
//   							var o = checkThis.find('#o');
   							console.log(o+"<<<<<<");
//   							console.log(o.text());
  							
// 							/* var oo = o.find('#o');
// 							console.log(oo) */
//  							//oo.attr('style', 'display: block')
						}
						/* else if(getRiCode==check[i]){
							console.log('교환필요없음')
							var x =checkThis.find('.x')
							//console.log(check + '<<<<<')
							$('.x').attr('style', 'display: block')
						} */
					}
						
						
					})
					
					request.fail(function( jqXHR, textStatus ) {
					  alert( "Request failed: " + textStatus );
					});
				}
			})
		})
	
		$(document).on('click','#checkall',function(){
			if($("#checkall").prop("checked")){
			    $("input[name=check]").prop("checked",true);
			}else{
				$("input[name=check]").prop("checked",false);
			}
		})
		
	</script>
</th:block>	
      
<th:block layout:fragment="customContents">

		<div>
			<h1>정기 점검표</h1>
				<button style="float:right;" id="periodBtn" value="period">교환주기 조회</button>
			<br>
		</div>
		
		<br>
		
		<table id="bootstrap-data-table" class="table table-striped table-bordered" name="routineList">
			<tr>	
				<td><label><input type="checkbox" id="checkall">선택</label></td>		
				<td>교환코드</td>
				<td>교환목록</td>
				<td>거리별 교환주기</td>
				<td>기간별 교환주기</td>
				<td>교환유무</td>
				<!-- <td>전체선택<input type="checkbox" id="checkall"></td> -->
				 
				
			</tr>
			<tr th:each="l : ${routineCheckList}" id="ch">
				<td><input type="checkbox" class="checkBox" name="check" th:value="${l.riCode}"></td>
				<td th:value = "${l.riCode}" th:text = "${l.riCode}" ></td>
				<td th:value = "${l.riItem}" th:text = "${l.riItem}" ></td>
				<td th:value = "${l.distanceCycle}" th:text="${l.distanceCycle}"></td>
				<td th:value = "${l.periodCycle}" th:text="${l.periodCycle}"></td>
				<td style="display: none;" class="o">교환필요</td>
				<td style="display: none;" class="x">교환필요없음</td>
			</tr>
		</table>

</th:block>
      
</html>