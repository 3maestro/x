<!DOCTYPE html>
<!-- layout:decorate 레이아웃 활용을 위한 속성 -->
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
      
<th:block layout:fragment="customTitle">
	<title>표준정기점검표</title>
</th:block>

<th:block layout:fragment="customScript">
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script type="text/javascript">
		
/* 	//체크박스클릭시 
	var checkArray = [];
	$('input[name=partCheck]').click(function(){
		//경고창 초기화
		$('.card-body').find('h2').empty();
		//장바구니 버튼초기화
		$('[name=partListForm]').find('span').empty();
		
		var partCheck = $('input[name=partCheck]:checked');
		//배열에 체크리스트담기
		$(this).each(function() {
			var checkVal = $(this).val(); 
			console.log("벨류값확인 : " + checkVal);
			checkArray.push(checkVal);
		});
		
		if(partCheck.length > 1){
			$('#buyPartBtn').text('다중부품구매');
			$('[name=partListForm]').attr({action:'/partGroupToOrder',method : 'POST'});
		}
		console.log(checkArray+"<담긴배열");
	}); */

	
	
		$(document).ready(function(){
			var check = [];
			var checkVal; 
			
			$('input[name=check]').click(function(){
				
				var checkSize = $("input:checkbox[name='check']:checked").length
				console.log(checkSize)
				
 				var checkThis = $("input:checkbox[name='check']:checked")
				$(this).each(function(){
					checkVal = $(this).val()
					console.log(checkVal + '<- checkVal?')
                	check.push(checkVal)
				})	
			})
			$('#periodBtn').click(function(){
				
				if(check == "undefined" || check == null){
					alert('항목을 체크 하시오.')
				}else{
					console.log(check + '<-뭐니')
					var request = $.ajax({
						  url: "/askCheck",	//호출될 url
						  method: "POST",
						  //최근 수리 내역 중 수리항목코드와 당시 수리 날짜
						  data: {"check" : check, "car":"KHMAJOU135795"},//파라미터
						  dataType: "json"		//응답 타입
					});
						 			
					request.done(function( data ) {
						console.log(data)
					
					for(var i=0; i<data.length; i++){
						var getRiCode = data[i];
						//console.log(getRiCode)
						console.log(checkVal + '<-checkVal')
						if(getRiCode == checkVal){
  							console.log('교환필요')
// 							console.log(check + '<-check?')
// 							$('#o').attr('style', 'display: block')
   							//var o = checkThis.find('#o');
   							//console.log(o+"<<<<<<");
//   							console.log(o.text());
  							
// 							/* var oo = o.find('#o');
// 							console.log(oo) */
//  							//oo.attr('style', 'display: block')
						}else if(getRiCode==checkVal){
							console.log('교환필요없음')
							//console.log(check + '<<<<<')
							//$('.x').attr('style', 'display: block')
						}
					}
						
						
					})
					
					request.fail(function( jqXHR, textStatus ) {
					  alert( "Request failed: " + textStatus );
					});
				}
			})
		})
	
		$(document).on('click','#checkall',function(){
			if($("#checkall").prop("checked")){
			    $("input[name=check]").prop("checked",true);
			}else{
				$("input[name=check]").prop("checked",false);
			}
		})
		
	</script>
</th:block>	
      
<th:block layout:fragment="customContents">

		<div>
			<h1>정기 점검표</h1>
				<button style="float:right;" id="periodBtn" value="period">교환주기 조회</button>
			<br>
		</div>
		
		<br>
		
		<table id="bootstrap-data-table" class="table table-striped table-bordered" name="routineList">
			<tr>	
				<td><label><input type="checkbox" id="checkall">선택</label></td>		
				<td>교환코드</td>
				<td>교환목록</td>
				<td>거리별 교환주기</td>
				<td>기간별 교환주기</td>
				<td>교환유무</td>
				<!-- <td>전체선택<input type="checkbox" id="checkall"></td> -->
				 
				
			</tr>
			<tr th:each="l : ${routineCheckList}" id="ch">
				<td><input type="checkbox" class="checkBox" name="check" th:value="${l.riCode}"></td>
				<td th:value = "${l.riCode}" th:text = "${l.riCode}" ></td>
				<td th:value = "${l.riItem}" th:text = "${l.riItem}" ></td>
				<td th:value = "${l.distanceCycle}" th:text="${l.distanceCycle}"></td>
				<td th:value = "${l.periodCycle}" th:text="${l.periodCycle}"></td>
				<td style="display: none;" id="o">교환필요</td>
				<td style="display: none;" class="x">교환필요없음</td>
			</tr>
		</table>

</th:block>
      
</html>